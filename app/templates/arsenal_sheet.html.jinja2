{% if not request.headers.hx_request %}
{% extends "layout.html.jinja2" %}
{% block title %} {{ (unit_arsenals|first).arsenal_owner.name }} &mdash; Arsenals | {% endblock %}
{% endif %}
{% block content %}
<div id="arsenalSheet">
    <div aria-busy="true" class="htmx-indicator"></div>
    <h2>{{ (unit_arsenals|first).arsenal_owner.name }}</h2>
    {% for arsenal in unit_arsenals %}
    <section>
        <hgroup>
            <h3>{{ arsenal.name }}<span class="{{ arsenal.icon_class }}"></span></h3>
            <p>{{ arsenal.desc }}</p>
        </hgroup>
        <select name="arsenalItemType" aria-label="Select weapon type" required
            _="on change set myFilter to me.value then show .arsenalItemType in #arsenalItems when its.getAttribute('data-category') is myFilter or myFilter=='all'">
            <option selected disabled value="">
                Select weapon type
            </option>
            <option value="all">All</option>
            {% set unique_wtypes = arsenal.items | map(attribute='weapon_type') | unique | list %}
            {% for item_type in unique_wtypes%}
            <option value="{{item_type}}">{{ item_type }}</option>
            {% endfor %}
        </select>
        <div id="arsenalItems">
            {% for item_type, item_list in arsenal.items | groupby('weapon_type') %}
            <div>
                <div class="arsenalItemType" data-category="{{ item_type }}">
                    {% for item in item_list | sort(attribute='weapon_rank_order_key,damage') %}
                    <div hx-get="/items/{{ item.nid }}" hx-trigger="load" hx-target="this">
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endfor %}
</div>
{% endblock content %}